<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ConversionAnalyzer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">BULL - Converter</a> &gt; <a href="index.source.html" class="el_package">com.hotels.beans.conversion.analyzer</a> &gt; <span class="el_source">ConversionAnalyzer.java</span></div><h1>ConversionAnalyzer.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2019-2020 Expedia, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.hotels.beans.conversion.analyzer;

import static java.util.Optional.empty;
import static java.util.Optional.of;

import static com.hotels.beans.conversion.processor.ConversionProcessorFactory.getConversionProcessor;
import static com.hotels.transformer.cache.CacheManagerFactory.getCacheManager;
import static com.hotels.transformer.utils.ClassUtils.isBigDecimal;
import static com.hotels.transformer.utils.ClassUtils.isBigInteger;
import static com.hotels.transformer.utils.ClassUtils.isBoolean;
import static com.hotels.transformer.utils.ClassUtils.isByte;
import static com.hotels.transformer.utils.ClassUtils.isByteArray;
import static com.hotels.transformer.utils.ClassUtils.isChar;
import static com.hotels.transformer.utils.ClassUtils.isDouble;
import static com.hotels.transformer.utils.ClassUtils.isFloat;
import static com.hotels.transformer.utils.ClassUtils.isInt;
import static com.hotels.transformer.utils.ClassUtils.isLong;
import static com.hotels.transformer.utils.ClassUtils.isShort;
import static com.hotels.transformer.utils.ClassUtils.isString;

import java.util.Optional;
import java.util.function.Function;

import com.hotels.beans.conversion.processor.ConversionProcessor;
import com.hotels.transformer.cache.CacheManager;
import com.hotels.transformer.utils.ClassUtils;

/**
 * This class provides method for converting a primitive input into another.
 */
public final class ConversionAnalyzer {
    /**
     * CacheManager instance {@link CacheManager}.
     */
<span class="fc" id="L51">    private static final CacheManager CACHE_MANAGER = getCacheManager(&quot;conversionAnalyzer&quot;);</span>

    /**
     * Class utils instance {@link ClassUtils}.
     */
    private final ClassUtils classUtils;

    /**
     * Default constructor.
     */
<span class="fc" id="L61">    public ConversionAnalyzer() {</span>
<span class="fc" id="L62">        this.classUtils = new ClassUtils();</span>
<span class="fc" id="L63">    }</span>

    /**
     * Analyzes Fields given as input and returns the conversion processor.
     * @param sourceClass source field class
     * @param targetClass the destination field class
     * @return an {@link Optional} containing the conversion function (if exists)
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public Optional&lt;Function&lt;Object, Object&gt;&gt; getConversionFunction(final Class&lt;?&gt; sourceClass, final Class&lt;?&gt; targetClass) {
<span class="fc" id="L73">        final String cacheKey = &quot;ConversionFunction-&quot; + sourceClass.getName() + &quot;-&quot; + targetClass.getName();</span>
<span class="fc" id="L74">        return CACHE_MANAGER.getFromCache(cacheKey, Optional.class).orElseGet(() -&gt; {</span>
<span class="fc" id="L75">            Optional conversionFunction = empty();</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">            if (!targetClass.getSimpleName().equalsIgnoreCase(sourceClass.getSimpleName())</span>
<span class="fc bfc" id="L77" title="All 4 branches covered.">                    &amp;&amp; (classUtils.isPrimitiveType(sourceClass) || classUtils.isPrimitiveTypeArray(sourceClass))) {</span>
<span class="fc" id="L78">                conversionFunction = getConversionProcessor(targetClass)</span>
<span class="fc" id="L79">                        .flatMap(cp -&gt; getTypeConversionFunction(cp, sourceClass));</span>
            }
<span class="fc" id="L81">            CACHE_MANAGER.cacheObject(cacheKey, conversionFunction);</span>
<span class="fc" id="L82">            return conversionFunction;</span>
        });
    }

    /**
     * Returns a function that converts to a primitive type: {@link Byte}, {@link Short}, {@link Integer}, {@link Long},
     * {@link Float}, {@link Double}, {@link Character} and {@link Boolean}.
     * @param conversionProcessor the {@link ConversionProcessor} for the given type
     * @param sourceFieldType he source field class
     * @return the conversion function
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    private Optional&lt;Function&lt;?, ?&gt;&gt; getTypeConversionFunction(final ConversionProcessor conversionProcessor, final Class&lt;?&gt; sourceFieldType) {
<span class="fc" id="L95">        Optional&lt;Function&lt;?, ?&gt;&gt; conversionFunction = empty();</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">        if (isString(sourceFieldType)) {</span>
<span class="fc" id="L97">            conversionFunction = of(conversionProcessor.convertString());</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">        } else if (isByte(sourceFieldType)) {</span>
<span class="fc" id="L99">            conversionFunction = of(conversionProcessor.convertByte());</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">        } else if (isShort(sourceFieldType)) {</span>
<span class="fc" id="L101">            conversionFunction = of(conversionProcessor.convertShort());</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">        } else if (isInt(sourceFieldType)) {</span>
<span class="fc" id="L103">            conversionFunction = of(conversionProcessor.convertInteger());</span>
<span class="fc bfc" id="L104" title="All 2 branches covered.">        } else if (isLong(sourceFieldType)) {</span>
<span class="fc" id="L105">            conversionFunction = of(conversionProcessor.convertLong());</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">        } else if (isFloat(sourceFieldType)) {</span>
<span class="fc" id="L107">            conversionFunction = of(conversionProcessor.convertFloat());</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">        } else if (isDouble(sourceFieldType)) {</span>
<span class="fc" id="L109">            conversionFunction = of(conversionProcessor.convertDouble());</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">        } else if (isChar(sourceFieldType)) {</span>
<span class="fc" id="L111">            conversionFunction = of(conversionProcessor.convertCharacter());</span>
<span class="fc bfc" id="L112" title="All 2 branches covered.">        } else if (isBoolean(sourceFieldType)) {</span>
<span class="fc" id="L113">            conversionFunction = of(conversionProcessor.convertBoolean());</span>
<span class="fc bfc" id="L114" title="All 2 branches covered.">        } else if (isBigInteger(sourceFieldType)) {</span>
<span class="fc" id="L115">            conversionFunction = of(conversionProcessor.convertBigInteger());</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">        } else if (isBigDecimal(sourceFieldType)) {</span>
<span class="fc" id="L117">            conversionFunction = of(conversionProcessor.convertBigDecimal());</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">        } else if (isByteArray(sourceFieldType)) {</span>
<span class="fc" id="L119">            conversionFunction = of(conversionProcessor.convertByteArray());</span>
        }
<span class="fc" id="L121">        return conversionFunction;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>