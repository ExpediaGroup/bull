<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from docs/site/markdown/transformer/bean/testing.md at $dateFormat.format( $currentDate )
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <title>Test your library â€“ BULL - Bean Utils Light Library</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
    <script src="../../js/apache-maven-fluido-1.8.min.js"></script>
<link rel="apple-touch-icon" sizes="180x180" href="images/icon/apple-touch-icon.png">
                <link rel="icon" type="image/png" sizes="32x32" href="images/icon/favicon-32x32.png">
                <link rel="icon" type="image/png" sizes="16x16" href="images/icon/favicon-16x16.png">
                <link rel="manifest" href="images/icon/site.webmanifest">
                <link rel="mask-icon" href="images/icon/safari-pinned-tab.svg" color="#5bbad5">
                <meta name="msapplication-TileColor" content="#ffffff">
                <meta name="theme-color" content="#ffffff">
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/ExpediaGroup/bull">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left">            <h1>BULL - Bean Utils Light Library
</h1></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="../../../" title="Home">Home</a><span class="divider">/</span></li>
      <li class=""><a href="../.././" title="Bean Utils Light Library">Bean Utils Light Library</a><span class="divider">/</span></li>
    <li class="active ">Test your library</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> $i18n.getString( "site-renderer", $locale, "template.lastpublished" ): $dateValue</li>
          <li id="projectVersion" class="pull-right">$i18n.getString( "site-renderer", $locale, "template.version" ): 3.0.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Project info</li>
    <li><a href="../../glossary.html" title="Glossary"><span class="none"></span>Glossary</a></li>
    <li><a href="../../kotlin.html" title="Use it in Kotlin"><span class="none"></span>Use it in Kotlin</a></li>
   <li class="nav-header">Transformer</li>
    <li><a href="../../transformer/beanTransformer.html" title="Bean Transformer"><span class="icon-chevron-down"></span>Bean Transformer</a>
     <ul class="nav nav-list">
      <li><a href="../../transformer/bean/samples.html" title="Samples"><span class="none"></span>Samples</a></li>
      <li><a href="../../transformer/bean/performance.html" title="Performances"><span class="none"></span>Performances</a></li>
      <li><a href="../../transformer/bean/thirdPartyLibComparison.html" title="Third Party Lib Comparison"><span class="none"></span>Third Party Lib Comparison</a></li>
      <li class="active"><a href="#"><span class="none"></span>How to test</a></li>
     </ul></li>
    <li><a href="../../transformer/mapTransformer.html" title="Map Transformer"><span class="icon-chevron-right"></span>Map Transformer</a></li>
   <li class="nav-header">Bean Validation</li>
    <li><a href="../../validator/samples.html" title="Samples"><span class="none"></span>Samples</a></li>
   <li class="nav-header">Primitive type conversion</li>
    <li><a href="../../converter/samples.html" title="Samples"><span class="none"></span>Samples</a></li>
   <li class="nav-header">Quality check</li>
    <li><a href="https://coveralls.io/github/ExpediaGroup/bull" class="externalLink" title="Coveralls"><span class="none"></span>Coveralls</a></li>
   <li class="nav-header">Related Articles</li>
    <li><a href="https://dzone.com/articles/how-to-transform-any-type-of-java-bean-with-one-li" class="externalLink" title="DZone"><span class="none"></span>DZone</a></li>
    <li><a href="../../articles.html" title="InfoQ"><span class="icon-chevron-right"></span>InfoQ</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="$i18n.getString( "site-renderer", $locale, "template.builtby" ) Maven" class="poweredBy"><img class="builtBy" alt="$i18n.getString( "site-renderer", $locale, "template.builtby" ) Maven" src="../../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >

<section><a id="Overview"></a>
<h1>Overview</h1>
<p>Software testing plays a fundamental role in software development because we can evaluate one or more properties of interest. In general, these properties indicate the
the extent to which the component or system under test:</p>
<ul>

<li>Meets the requirements that guided its design and development,</li>
<li>responds correctly to all kinds of inputs,</li>
<li>performs its functions within an acceptable time,</li>
<li>it is sufficiently usable,</li>
<li>Can be installed and run in its intended environments</li>
<li>achieves the general result of its stakeholder's desire.</li>
</ul>
<p>This page will show how to test BULL into a simple project. All the examples utilize <a href="https://github.com/junit-team" class="externalLink">JUnit</a>, <a href="https://site.mockito.org/" class="externalLink">Mockito</a> and <a href="https://assertj.github.io/doc/" class="externalLink">AssertJ</a></p>
<p>The Java Bean transformation function can be tested in two different ways that depend on the following scenarios:</p>
<ol style="list-style-type: decimal;">

<li>The destination object does not require a special configuration to get transformed</li>
<li>The destination object requires a special configuration, but you are confident that the configuration is working fine as it doesn't include any special action</li>
<li>The destination object requires a special configuration that needs to be tested as we are not confident that it would work</li>
</ol>
<p>For both scenarios: 1 and 2 we can use a mocked version of the <code>BeanUtils</code> object.</p><section><section><a id="Before_start"></a>
<h3>Before start</h3>
<p>As BULL contains final methods that need to be mocked and, as Mockito requires a special configuration in order to mock final classes/methods, an extension needs
to be added to the test resource folder. This file is available <a href="https://github.com/ExpediaGroup/bull/tree/master/src/test/resources/mockito-extensions" class="externalLink">here</a>.</p>
<p>All the examples will be based on the following source object and destination object:</p>

<pre><code class="language-java">public class SampleRequest {                                public class DestObject {                           
   private final BigInteger x;                                 @NotNull                   
   private final BigInteger y;                                 private BigInteger x;                      
                                                               private final BigInteger y;                 
   // constructors                                             // constructors
   // getters and setters                                      // getters and setters
}                                                           }
</code></pre></section><section><a id="First_scenario"></a>
<h3>First scenario</h3>
<p>#####The destination object does not require a special configuration to get transformed</p>
<p>Given the following service class that contains the <code>BeanUtils</code> library:</p>

<pre><code class="language-java">import ...

public class SampleClass {
    
    private final BeanUtils beanUtils;
    
    public SampleClass() {
        this.beanUtils = new BeanUtils();
    }

    public BigInteger doSomething(final SampleRequest request) {
        final Transformer beanTransformer = beanUtils.getTransformer();
        DestObject destObject = beanTransformer.transform(request, DestObject.class);
        return multiplyValues(destObject.getX(), destObject.getY());
    }
    
    private BigInteger multiplyValues(final BigInteger x, final BigInteger y) {
         return x.multiply(y);
    }
}
</code></pre>
<p>The test class will be:</p>

<pre><code class="language-java">import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.MockitoAnnotations.openMocks;
import static org.mockito.Mockito.when;
import static org.mockito.Mockito.mock;

import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;

import com.expediagroup.beans.transformer.BeanUtils;
import com.expediagroup.transformer.Transformer;
import com.expediagroup.transformer.error.InvalidBeanException;

/**
 * Unit test for {@link SampleClass}.
 */
public class SampleClassTest {
    private static final BigInteger EXPECTED_RESULT = new BigInteger(20); 
    /**
     * The class to be tested.
     */
    @InjectMocks
    private SampleClass underTest;
    
    @Mock
    private BeanUtils beanUtils;

    /**
     * Initialized mocks.
     */
    @Before
    public void beforeMethod() {
        openMocks(this);
    }

    /**
     * Test that a SampleResponse is returned.
     */
    @Test
    public void testDoSomethingWorksProperly() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(BigInteger.TEN, BigInteger.TWO);
        DestObject destObject = createDestObject(BigInteger.TEN, BigInteger.TWO);
        Transformer beanTransformer = mock(Transformer.class);
        when(beanUtils.getTransformer()).thenReturn(beanTransformer);
        when(beanTransformer.transform(sampleRequest, DestObject.class)).thenReturn(destObject);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
        verify(beanUtils).getTransformer();
        verify(beanTransformer).transform(sampleRequest, DestObject.class);
        assertThat(actual).isEqualTo(EXPECTED_RESULT);
    }
    
    /**
     * Test that an {@link InvalidBeanException} is thrown when the {@code id} field in the {@link SampleRequest}
     * doesn't met the constraints defined into {@link DestObject}.
     */
    @Test(expected = InvalidBeanException.class)
    public void testThatAnExceptionIsThrownWhenConstraintsAreNotMet() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(null, BigInteger.TWO);
        Transformer beanTransformer = mock(Transformer.class);
        when(beanUtils.getTransformer()).thenReturn(beanTransformer);
        when(beanTransformer.transform(sampleRequest, DestObject.class)).thenThrow(InvalidBeanException.class);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
    }
    
    private SampleRequest createSampleRequest(final BigInteger x, final BigInteger y) {
        return new SampleRequest();
    }
    
    private DestObject createDestObject(final BigInteger x, final BigInteger y) {
       return new DestObject(x, y);
    }
}
</code></pre></section><section><a id="Second_scenario.3A"></a>
<h3>Second scenario:</h3>
<p>#####The destination object requires a special configuration, but you are confident that the configuration is working fine as it doesn't include any particular instruction.</p>
<p>Given the following service class:</p>

<pre><code class="language-java">import ...

public class SampleClass {
    
    private final BeanUtils beanUtils;
    
    public SampleClass() {
        this.beanUtils = new BeanUtils();
    }

    public BigInteger doSomething(final SampleRequest request) {
        final Transformer beanTransformer = beanUtils.getTransformer();
        FieldTransformer&lt;BigInteger, BigInteger&gt; prodTransformer = new FieldTransformer&lt;&gt;(&quot;y&quot;, val -&gt; val.multiply(BigInteger.TWO));
        DestObject destObject = beanTransformer
                                   .withFieldTransformer(prodTransformer)
                                   .transform(request, DestObject.class);
        return multiplyValues(destObject.getX(), destObject.getY());
    }
    
    private BigInteger multiplyValues(final BigInteger x, final BigInteger y) {
         return x.multiply(y);
    }
}
</code></pre>
<p>The test class will be:</p>

<pre><code class="language-java">import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.MockitoAnnotations.openMocks;
import static org.mockito.Mockito.when;
import static org.mockito.Mockito.mock;
import static org.mockito.ArgumentMatchers.any;

import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;

import com.expediagroup.beans.transformer.BeanUtils;
import com.expediagroup.transformer.Transformer;
import com.expediagroup.transformer.error.InvalidBeanException;

/**
 * Unit test for {@link SampleClass}.
 */
public class SampleClassTest {
    private static final BigInteger EXPECTED_RESULT = new BigInteger(40); 
    /**
     * The class to be tested.
     */
    @InjectMocks
    private SampleClass underTest;
    
    @Mock
    private BeanUtils beanUtils;

    /**
     * Initialized mocks.
     */
    @Before
    public void beforeMethod() {
        openMocks(this);
    }

    /**
     * Test that a SampleResponse is returned.
     */
    @Test
    public void testDoSomethingWorksProperly() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(BigInteger.TEN, BigInteger.TWO);
        DestObject destObject = createDestObject(BigInteger.TEN, BigInteger.TWO.multiply(BigInteger.TWO));
        Transformer beanTransformer = mock(Transformer.class);
        when(beanUtils.getTransformer()).thenReturn(beanTransformer);
        when(beanTransformer.withFieldTransformer(any(FieldTransformer.class))).thenReturn(beanTransformer);
        when(beanTransformer.transform(sampleRequest, DestObject.class)).thenReturn(destObject);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
        verify(beanUtils).getTransformer();
        verify(beanTransformer).withFieldTransformer(any(FieldTransformer.class));
        verify(beanTransformer).transform(sampleRequest, DestObject.class);
        assertThat(actual).isEqualTo(EXPECTED_RESULT);
    }
    
    /**
     * Test that an {@link InvalidBeanException} is thrown when the {@code id} field in the {@link SampleRequest}
     * doesn't met the constraints defined into {@link DestObject}.
     */
    @Test(expected = InvalidBeanException.class)
    public void testThatAnExceptionIsThrownWhenConstraintsAreNotMet() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(null, BigInteger.TWO);
        Transformer beanTransformer = mock(Transformer.class);
        when(beanUtils.getTransformer()).thenReturn(beanTransformer);
        when(beanTransformer.withFieldTransformer(any(FieldTransformer.class))).thenReturn(beanTransformer);
        when(beanTransformer.transform(sampleRequest, DestObject.class)).thenThrow(InvalidBeanException.class);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
    }
    
    private SampleRequest createSampleRequest(final BigInteger x, final BigInteger y) {
        return new SampleRequest();
    }
    
    private DestObject createDestObject(final BigInteger x, final BigInteger y) {
        return new DestObject(x, y);
    }
}
</code></pre></section><section><a id="Third_scenario.3A"></a>
<h3>Third scenario:</h3>
<p>#####The destination object requires a special configuration that needs to be tested as you are not confident that it would work</p>
<p>Given the following service class:</p>

<pre><code class="language-java">import ...

public class SampleClass {
    
    private final BeanUtils beanUtils;
    
    public SampleClass() {
        this.beanUtils = new BeanUtils();
    }

    public BigInteger doSomething(final SampleRequest request) {
        final Transformer beanTransformer = beanUtils.getTransformer();
        FieldTransformer&lt;BigInteger, BigInteger&gt; prodTransformer = new FieldTransformer&lt;&gt;(&quot;y&quot;, val -&gt; val.multiply(BigInteger.TWO));
        DestObject destObject = beanTransformer
                                   .withFieldTransformer(prodTransformer)
                                   .transform(request, DestObject.class);
        return multiplyValues(destObject.getX(), destObject.getY());
    }
    
    private BigInteger multiplyValues(final BigInteger x, final BigInteger y) {
         return x.multiply(y);
    }
}
</code></pre>
<p>The test class will be:</p>

<pre><code class="language-java">import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.MockitoAnnotations.openMocks;

import java.lang.reflect.Field;

import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;

import com.expediagroup.beans.transformer.BeanUtils;

/**
 * Unit test for {@link SampleClass}.
 */
public class SampleClassTest {
    private static final BigInteger EXPECTED_RESULT = new BigInteger(40); 
    /**
     * The class to be tested.
     */
    @InjectMocks
    private SampleClass underTest;
    
    /**
     * Initialized mocks.
     */
    @Before
    public void beforeMethod() {
        openMocks(this);
        // injects a real BeanUtils instance into the test class
        setFieldValue(underTest, &quot;beanUtils&quot;, new BeanUtils());
    }

    /**
     * Test that a SampleResponse is returned.
     */
    @Test
    public void testDoSomethingWorksProperly() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(BigInteger.TEN, BigInteger.TWO);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
        assertThat(actual).isEqualTo(EXPECTED_RESULT);
    }
    
    /**
     * Test that an {@link InvalidBeanException} is thrown when the {@code id} field in the {@link SampleRequest}
     * doesn't met the constraints defined into {@link DestObject}.
     */
    @Test(expected = InvalidBeanException.class)
    public void testThatAnExceptionIsThrownWhenConstraintsAreNotMet() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(null, BigInteger.TWO);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
    }
    
    private SampleRequest createSampleRequest(final BigInteger x, final BigInteger y) {
        return new SampleRequest();
    }
    
    /**
     * Sets the value of a field through {@link Field#set} method.
     * @param target the field's class
     * @param fieldName the field's name to set
     * @param fieldValue the value to set
     */
    private void setFieldValue(final Object target, final String fieldName, final Object fieldValue) throws NoSuchFieldException {
        final Field field = target.getClass().getDeclaredField(fieldName);
        final boolean isAccessible = field.canAccess(target);
        try {
            if (!isAccessible) {
                field.setAccessible(true);
            }
            field.set(target, fieldValue);
        } catch (final Exception e) {
            throw new IllegalStateException(e);
        } finally {
            if (!isAccessible) {
                field.setAccessible(false);
            }
        }
    }
}
</code></pre></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2019&#x2013;${currentYear}<a href="http://expediagroup.com">Expedia Group</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
