<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from docs/site/markdown/transformer/testing.md at 2019-05-26
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20190526" />
    <meta http-equiv="Content-Language" content="en" />
    <title>BULL - Bean Utils Light Library Parent &#x2013; Test your library</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/HotelsDotCom/bull">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>BULL - Bean Utils Light Library Parent</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../" title="Home">Home</a><span class="divider">/</span></li>
      <li class=""><a href=".././" title="BULL - Bean Utils Light Library Parent">BULL - Bean Utils Light Library Parent</a><span class="divider">/</span></li>
    <li class="active ">Test your library</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-05-26</li>
          <li id="projectVersion" class="pull-right">Version: 1.4.2.2</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project info</li>
    <li><a href="../glossary.html" title="Glossary"><span class="none"></span>Glossary</a></li>
      <li class="nav-header">Bean Transformer</li>
    <li><a href="../transformer/samples.html" title="Samples"><span class="none"></span>Samples</a></li>
    <li><a href="../transformer/performance.html" title="Performances"><span class="none"></span>Performances</a></li>
    <li><a href="../transformer/thirdPartyLibComparison.html" title="Third Party Lib Comparison"><span class="none"></span>Third Party Lib Comparison</a></li>
    <li class="active"><a href="#"><span class="none"></span>How to test</a></li>
      <li class="nav-header">Bean Validation</li>
    <li><a href="../validator/samples.html" title="Samples"><span class="none"></span>Samples</a></li>
      <li class="nav-header">Quality check</li>
    <li><a href="../jacoco/index.html" title="Test coverage"><span class="none"></span>Test coverage</a></li>
    <li><a href="https://sonarcloud.io/dashboard?id=BULL" class="externalLink" title="SonarCloud"><span class="none"></span>SonarCloud</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >

<h1>Overview</h1>
<p>Software testing plays a fundamental role in the software development because we can evaluate one or more properties of interest. In general, these properties indicate the extent to which the component or system under test:</p>
<ul>

<li>meets the requirements that guided its design and development,</li>
<li>responds correctly to all kinds of inputs,</li>
<li>performs its functions within an acceptable time,</li>
<li>it is sufficiently usable,</li>
<li>can be installed and run in its intended environments</li>
<li>achieves the general result its stakeholders desire.</li>
</ul>
<p>This page will show how to test BULL into a simple project. All the examples utilizes <a class="externalLink" href="https://github.com/junit-team">JUnit</a> and <a class="externalLink" href="https://site.mockito.org/">Mockito</a>.</p>
<p>The Java Bean transformation function can be tested in two different ways that depends on the following scenarios:</p>
<ol style="list-style-type: decimal">

<li>The destination object does not require a special configuration to get transformed</li>
<li>The destination object requires a special configuration, but you are confident that the configuration is working fine as it doesn&#x2019;t includes any special action</li>
<li>The destination object requires a special configuration that needs to be tested as we are not confident that it would work</li>
</ol>
<p>For both scenarios: 1 and 2 we can use a mocked version the <tt>BeanUtils</tt> object.</p>
<div class="section">
<div class="section">
<h3><a name="Before_start"></a>Before start</h3>
<p>As BULL contains final methods that needs to be mocked and, as Mockito requires a special configuration in order to mock final classes/methods, an extension needs to be added to the test resource folder. This file is available <a class="externalLink" href="https://github.com/HotelsDotCom/bull/tree/master/src/test/resources/mockito-extensions">here</a>.</p>
<p>All the examples will be based on the following source object and destination object:</p>

<div>
<div>
<pre class="source">public class SampleRequest {                                public class DestObject {                           
   private final BigInteger x;                                 @NotNull                   
   private final BigInteger y;                                 private BigInteger x;                      
                                                               private final BigInteger y;                 
   // constructors                                             // constructors
   // getters and setters                                      // getters and setters
}                                                           }
</pre></div></div>
</div>
<div class="section">
<h3><a name="First_scenario"></a>First scenario</h3>
<div class="section">
<div class="section">
<h5><a name="The_destination_object_does_not_require_a_special_configuration_to_get_transformed"></a>The destination object does not require a special configuration to get transformed</h5>
<p>Given the following service class that contains the <tt>BeanUtils</tt> library:</p>

<div>
<div>
<pre class="source">import ...

public class SampleClass {
    
    private final BeanUtils beanUtils;
    
    public SampleClass() {
        this.beanUtils = new BeanUtils();
    }

    public BigInteger doSomething(final SampleRequest request) {
        final Transformer beanTransformer = beanUtils.getTransformer();
        DestObject destObject = beanTransformer.transform(request, DestObject.class);
        return multiplyValues(destObject.getX(), destObject.getY());
    }
    
    private BigInteger multiplyValues(final BigInteger x, final BigInteger y) {
         return x.multiply(y);
    }
}
</pre></div></div>

<p>The test class will be:</p>

<div>
<div>
<pre class="source">import static org.junit.Assert.assertEquals;
import static org.mockito.MockitoAnnotations.initMocks;
import static org.mockito.Mockito.when;
import static org.mockito.Mockito.mock;

import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;

import com.hotels.beans.transformer.BeanUtils;
import com.hotels.beans.transformer.Transformer;
import com.hotels.beans.error.InvalidBeanException;

/**
 * Unit test for {@link SampleClass}.
 */
public class SampleClassTest {
    private static final BigInteger EXPECTED_RESULT = new BigInteger(20); 
    /**
     * The class to be tested.
     */
    @InjectMocks
    private SampleClass underTest;
    
    @Mock
    private BeanUtils beanUtils;

    /**
     * Initialized mocks.
     */
    @Before
    public void beforeMethod() {
        initMocks(this);
    }

    /**
     * Test that a SampleResponse is returned.
     */
    @Test
    public void testDoSomethingWorksProperly() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(BigInteger.TEN, BigInteger.TWO);
        DestObject destObject = createDestObject(BigInteger.TEN, BigInteger.TWO);
        Transformer beanTransformer = mock(Transformer.class);
        when(beanUtils.getTransformer()).thenReturn(beanTransformer);
        when(beanTransformer.transform(sampleRequest, DestObject.class)).thenReturn(destObject);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
        verify(beanUtils).getTransformer();
        verify(beanTransformer).transform(sampleRequest, DestObject.class);
        assertEquals(EXPECTED_RESULT, actual);
    }
    
    /**
     * Test that an {@link InvalidBeanException} is thrown when the {@code id} field in the {@link SampleRequest}
     * doesn't met the constraints defined into {@link DestObject}.
     */
    @Test(expected = InvalidBeanException.class)
    public void testThatAnExceptionIsThrownWhenConstraintsAreNotMet() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(null, BigInteger.TWO);
        Transformer beanTransformer = mock(Transformer.class);
        when(beanUtils.getTransformer()).thenReturn(beanTransformer);
        when(beanTransformer.transform(sampleRequest, DestObject.class)).thenThrow(InvalidBeanException.class);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
    }
    
    private SampleRequest createSampleRequest(final BigInteger x, final BigInteger y) {
        return new SampleRequest();
    }
    
    private DestObject createDestObject(final BigInteger x, final BigInteger y) {
       return new DestObject(x, y);
    }
}
</pre></div></div>
</div></div></div>
<div class="section">
<h3><a name="Second_scenario:"></a>Second scenario:</h3>
<div class="section">
<div class="section">
<h5><a name="The_destination_object_requires_a_special_configuration.2C_but_you_are_confident_that_the_configuration_is_working_fine_as_it_doesn.E2.80.99t_includes_any_particular_instruction."></a>The destination object requires a special configuration, but you are confident that the configuration is working fine as it doesn&#x2019;t includes any particular instruction.</h5>
<p>Given the following service class:</p>

<div>
<div>
<pre class="source">import ...

public class SampleClass {
    
    private final BeanUtils beanUtils;
    
    public SampleClass() {
        this.beanUtils = new BeanUtils();
    }

    public BigInteger doSomething(final SampleRequest request) {
        final Transformer beanTransformer = beanUtils.getTransformer();
        FieldTransformer&lt;BigInteger, BigInteger&gt; prodTransformer = new FieldTransformer&lt;&gt;(&quot;y&quot;, val -&gt; val.multiply(BigInteger.TWO));
        DestObject destObject = beanTransformer
                                   .withFieldTransformer(prodTransformer)
                                   .transform(request, DestObject.class);
        return multiplyValues(destObject.getX(), destObject.getY());
    }
    
    private BigInteger multiplyValues(final BigInteger x, final BigInteger y) {
         return x.multiply(y);
    }
}
</pre></div></div>

<p>The test class will be:</p>

<div>
<div>
<pre class="source">import static org.junit.Assert.assertEquals;
import static org.mockito.MockitoAnnotations.initMocks;
import static org.mockito.Mockito.when;
import static org.mockito.Mockito.mock;
import static org.mockito.ArgumentMatchers.any;

import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;

import com.hotels.beans.transformer.BeanUtils;
import com.hotels.beans.transformer.Transformer;
import com.hotels.beans.error.InvalidBeanException;

/**
 * Unit test for {@link SampleClass}.
 */
public class SampleClassTest {
    private static final BigInteger EXPECTED_RESULT = new BigInteger(40); 
    /**
     * The class to be tested.
     */
    @InjectMocks
    private SampleClass underTest;
    
    @Mock
    private BeanUtils beanUtils;

    /**
     * Initialized mocks.
     */
    @Before
    public void beforeMethod() {
        initMocks(this);
    }

    /**
     * Test that a SampleResponse is returned.
     */
    @Test
    public void testDoSomethingWorksProperly() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(BigInteger.TEN, BigInteger.TWO);
        DestObject destObject = createDestObject(BigInteger.TEN, BigInteger.TWO.multiply(BigInteger.TWO));
        Transformer beanTransformer = mock(Transformer.class);
        when(beanUtils.getTransformer()).thenReturn(beanTransformer);
        when(beanTransformer.withFieldTransformer(any(FieldTransformer.class))).thenReturn(beanTransformer);
        when(beanTransformer.transform(sampleRequest, DestObject.class)).thenReturn(destObject);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
        verify(beanUtils).getTransformer();
        verify(beanTransformer).withFieldTransformer(any(FieldTransformer.class));
        verify(beanTransformer).transform(sampleRequest, DestObject.class);
        assertEquals(EXPECTED_RESULT, actual);
    }
    
    /**
     * Test that an {@link InvalidBeanException} is thrown when the {@code id} field in the {@link SampleRequest}
     * doesn't met the constraints defined into {@link DestObject}.
     */
    @Test(expected = InvalidBeanException.class)
    public void testThatAnExceptionIsThrownWhenConstraintsAreNotMet() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(null, BigInteger.TWO);
        Transformer beanTransformer = mock(Transformer.class);
        when(beanUtils.getTransformer()).thenReturn(beanTransformer);
        when(beanTransformer.withFieldTransformer(any(FieldTransformer.class))).thenReturn(beanTransformer);
        when(beanTransformer.transform(sampleRequest, DestObject.class)).thenThrow(InvalidBeanException.class);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
    }
    
    private SampleRequest createSampleRequest(final BigInteger x, final BigInteger y) {
        return new SampleRequest();
    }
    
    private DestObject createDestObject(final BigInteger x, final BigInteger y) {
        return new DestObject(x, y);
    }
}
</pre></div></div>
</div></div></div>
<div class="section">
<h3><a name="Third_scenario:"></a>Third scenario:</h3>
<div class="section">
<div class="section">
<h5><a name="The_destination_object_requires_a_special_configuration_that_needs_to_be_tested_as_you_are_not_confident_that_it_would_work"></a>The destination object requires a special configuration that needs to be tested as you are not confident that it would work</h5>
<p>Given the following service class:</p>

<div>
<div>
<pre class="source">import ...

public class SampleClass {
    
    private final BeanUtils beanUtils;
    
    public SampleClass() {
        this.beanUtils = new BeanUtils();
    }

    public BigInteger doSomething(final SampleRequest request) {
        final Transformer beanTransformer = beanUtils.getTransformer();
        FieldTransformer&lt;BigInteger, BigInteger&gt; prodTransformer = new FieldTransformer&lt;&gt;(&quot;y&quot;, val -&gt; val.multiply(BigInteger.TWO));
        DestObject destObject = beanTransformer
                                   .withFieldTransformer(prodTransformer)
                                   .transform(request, DestObject.class);
        return multiplyValues(destObject.getX(), destObject.getY());
    }
    
    private BigInteger multiplyValues(final BigInteger x, final BigInteger y) {
         return x.multiply(y);
    }
}
</pre></div></div>

<p>The test class will be:</p>

<div>
<div>
<pre class="source">import static org.junit.Assert.assertEquals;
import static org.mockito.MockitoAnnotations.initMocks;

import java.lang.reflect.Field;

import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;

import com.hotels.beans.transformer.BeanUtils;

/**
 * Unit test for {@link SampleClass}.
 */
public class SampleClassTest {
    private static final BigInteger EXPECTED_RESULT = new BigInteger(40); 
    /**
     * The class to be tested.
     */
    @InjectMocks
    private SampleClass underTest;
    
    /**
     * Initialized mocks.
     */
    @Before
    public void beforeMethod() {
        initMocks(this);
        // injects a real BeanUtils instance into the test class
        setFieldValue(underTest, &quot;beanUtils&quot;, new BeanUtils());
    }

    /**
     * Test that a SampleResponse is returned.
     */
    @Test
    public void testDoSomethingWorksProperly() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(BigInteger.TEN, BigInteger.TWO);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
        assertEquals(EXPECTED_RESULT, actual);
    }
    
    /**
     * Test that an {@link InvalidBeanException} is thrown when the {@code id} field in the {@link SampleRequest}
     * doesn't met the constraints defined into {@link DestObject}.
     */
    @Test(expected = InvalidBeanException.class)
    public void testThatAnExceptionIsThrownWhenConstraintsAreNotMet() {
        //GIVEN
        SampleRequest sampleRequest = createSampleRequest(null, BigInteger.TWO);
        
        //WHEN
        final BigInteger actual = underTest.doSomething(sampleRequest);

        //THEN
    }
    
    private SampleRequest createSampleRequest(final BigInteger x, final BigInteger y) {
        return new SampleRequest();
    }
    
    /**
     * Sets the value of a field through {@link Field#set} method.
     * @param target the field's class
     * @param fieldName the field's name to set
     * @param fieldValue the value to set
     */
    private void setFieldValue(final Object target, final String fieldName, final Object fieldValue) throws NoSuchFieldException {
        final Field field = target.getClass().getDeclaredField(fieldName);
        final boolean isAccessible = field.canAccess(target);
        try {
            if (!isAccessible) {
                field.setAccessible(true);
            }
            field.set(target, fieldValue);
        } catch (final Exception e) {
            throw new IllegalStateException(e);
        } finally {
            if (!isAccessible) {
                field.setAccessible(false);
            }
        }
    }
}
</pre></div></div></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2019
<a href="http://hotels.com">Hotels.com (Data Platform Team)</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
