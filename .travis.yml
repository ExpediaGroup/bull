language: java
cache:
  directories:
  - "~/.m2/repository"
jdk: openjdk11
env:
  global:
  # HCOM_OSSRH_USERNAME
  - secure: A1THwDcKNrR/+nHj8Hu8aEjUeh1T1FKKg/sZ3CArAldt7U2IH/DndS5vi8+58B85eDFNByu6bOtqYls13Y9pKWyjY7nEBJtqQ79BFN22G85wZiiVHawFdsdOSN7gMSDQHfbZaJrayliAUuQAgsgqtHPTkgBG8dv3QIVE1G8ILiV0Ui6JYpE+FVysIdeYpcWnhKpjX95jpTLuKqiBfVqgpT6Y24P9No8N37YgtgnYOXwn2u1AdwZ6bbeSria/n+Napi2pTtgTc0zQ4PMaowFv1P6/LuSPCs/XNfuCB9EzfIpXYUtOvoF9KQ0OqtyKrldAlOHC/cGkBWOcA8GNpJ4ONr0oCarZUPI3mV/ecx6q0dpqYF/Smy1Hj5tpYgSiXpDGTGg2fgawmTsr0faU2XbSFp1IWEnib0uQ9PhXUHg01MmnMp2pqCvNzPBjai7Lhquf/ykLqXfgO0ntDsqsTxe24nBKN3Azz5CJrkgjwgNxZMH+DQmNhHWA7QEUYBO2+wIrDNc3vaItpGsU7VrtX2dNPmfDl865ODPJEqClyYFkO7h3E+Zzx1tW4hdDEW6ME5UM6opbI02luOcifC2WxcfCDDaBa/n2KzGIAvThC0N+bdRLQPPNT+Rs0eqOwH/+LrODT9HzpcGgCZ32Cqm59t4xJXrIlcd5pVEEg535HU26638=
  # HCOM_OSSRH_PASSWORD
  - secure: Bq043/gjNIWaP0t2cniKabnHSSB3LmDnYSBYBqdll/pp/wHTChs5OcW1UamXfVsBY9pF7GpYroLvkqkUV7k5lnA5aFWoJaU/Ehh/WvIwge8cJxF6ie/pxjdnVS5P5aSB39brm8IU97zOoyzT4cdPuMvQSSemwqC/rU5FD5CfO1sb2WRJkJHsY3oP3FHVW3aLldGC1MlsQ95wfIGeGUpx/LtUlZvxf+fNrs83YVW+v2Ibj6+YueTPzKLk5yAuzCh2qG97dkI5XTMRbjxBICCK7GsXaoUCx+Ix+Sa97MlASQzgEYZz77s4TU6h+oV5BLNR+/aW0bpFFXNIVe9m+ZBW4APbVq5tvDXsbEy/7qYrETT5F7ZasCGOGQUgmqqbWuIxB/fcxA4jMvBEniBSo6ifdQkjyoEjWLoQtApsbYCA7Mtg8cVyVHx1oWyQgg+9Q30KPMVkXP8GufPdl3dpAdpzHxYwghtPzVVAlxkAGjHTo/AzVGh4T8qLZwUY3WVtZie6ZYZ1WRpa9dlvLeQ+T42r4buI0/ndpbfQyT5OxrURllMwpk1XZPH7GgCQ+fRalhhsu+32wIVXE/jGTDst2+Z59kv8p8LaKp7H4IU3ZUsuQw3Q41vm3zqBY00t9kyJOVGAzAC/jyeNYEULYUgrkcGlVe+9Zug/F8RCpNsLD2bXtRk=
  # GPG_KEYNAME
  - secure: VGoLyHHb4exm8mw1OSS+zUWGqxcDOx9F2GF5q7TKr5uiqhMkBCz1Y4hTgBakYWfJLdhQl8F/UkUpjqVPN6NHz3q87aLeZtc5GB9D+kXhTuoMIZ34p0U5HEk63v06VvfmoMUfahEVZVeb3RWUAQGuliGokyiMRS3u4hK9UDTx91x4RRx/83pHn4o6NRAzIXyOoQIYwuLbCIleNVe35Ok2LKdk7NQ2i+nDVLdnjeuHWoF27R33CeiRRV+GvF7aJRksqKwPPS63nn6aGtEmlzemyYbiwDZ1wQbf9nuSZLaU78unTGq6qyVrYbpxegWHclPsM5EKxO34uqi3m0GLRuy/W+u0R9dRaCMk4aEPmz56ClDPrmjssMXn+pyumsKU4932aVA1Q/IP14H19P/3eH2FvJLnO00eGdKgqvVRbomOyRqlRWCI/mUsR0aAr+Go+32Orf88v79EAT0WmXBYgGiJR7d2Ig7YZxY5KnM+rto59J9tZbWQJRYr+jkw5W8dPTMVQ+a4T6kGcOR4e54KIqkW1BVa/I+aaiZSP0BrIGEbk2b1UmoYGOuxOBjs0ESDHaj6KFQK026WAoedQ/bYa8J+j7JRIg/ivlvH5eycXSFTXLt4Qym/iZ8SOnJr1mWTF4xCaOmyUBqSHS2tOPJiGuNdRpFep8QT9vBEXpej2yOLyDA=
  # GPG_PASSPHRASE
  - secure: bFylqtr43v1wetXH/b1RJDmsDzwn6ILfFnw0rVFVKdpYndoyL3J05A3qYdZ+K1cePP7cYnetfOlMnv/e1LDGSzQ/C2RmPgEZIPRozxg0t9S+QU/G+Ro5m1VhrEDOpJv2A7IxY7WBgWEhChIKTZlDK4c2rzXDJ/Z799QQRmiOu04zGVBUjPcbU01QlFF71e3Vf5sovBPSWPifmqyKHZPquqXbY5Jo36MDAO5b3aD/rk/6nkzB+b10fAEJ/9sXX14S0ItTc7CWkjGdqjMsu9lMYUZ8Au2YgBtGAU3XBG30+uhKk7Z2XZj8Ne9QJhPbzzt53bB0loa8pQ+k6NGcCPRoTZOI3tAKKPxXf1sRolE3gYmje1GcREvsXRnZbwfZuayCOBdEXFFZzmijz/H5UgNS5rUwrY+FH6Dl4AZsQvDJdC4nJ4IVo6knRM4yx4ooI47tJBLLQS5cFOTmpYnQdZZLr5s4EPRhFpqSa61a2ZoBzTDl4Jj3M/zZ9xtIajYEdYSZ/wGpErsA/KJbHnP32lukTVG86Ndh4E2xLVVo1U5iwTZA6EsvarHKvEqLGtOYMyC2TqxuTlgzsfuGkonAlj9jx8I51Hjc5NMuamqWl4uLY2nC2BpTY1Gaufb0AJkTfp0W1/yPxaS2SGYo18UDobOGQfDniEe4CiVUkpACj0Jq7kY=
install: skip
jobs:
  include:
  - stage: Build
    name: Build and Test
    install: travis_retry mvn clean install -DskipTests
  - stage: Site Build and Quality check
    name: Publishing site and performing a code quality check
    if: type NOT IN (pull_request) AND tag IS present
    before_deploy:
    - mvn versions:set -D newVersion=${TRAVIS_TAG}
    - travis_retry mvn install sonar:sonar -Dsonar.projectKey=${sonar_project_key}
      -Dsonar.organization=${sonar_organization} -Dsonar.host.url=${sonar_host_url}
      -Dsonar.login=${sonar_token} site:site javadoc:aggregate -P site-release
    deploy:
      provider: pages
      local-dir: target/site
      skip-cleanup: true
      github-token: "${github_oauth_token}"
      keep-history: true
      on:
        tags: true
  - stage: Release
    name: Releasing artifacts
    if: type NOT IN (pull_request) AND tag IS present
    install: skip
    after_deploy: skip
    before_script:
    - openssl aes-256-cbc -K $encrypted_bbb0f94c13c1_key -iv $encrypted_bbb0f94c13c1_iv
      -in config/travis/private-key.gpg.enc -out config/travis/private-key.gpg -d
    - mvn versions:set -D newVersion=${TRAVIS_TAG}
    - mvn install -DskipTests -Dmaven.test.skip=true javadoc:aggregate
    deploy:
    - provider: script
      script: config/travis/deploy.sh
      skip_cleanup: true
      on:
        tags: true
notifications:
  slack:
    rooms:
    - bull-crew:hTuN6VsJod6aUOU6FWIFiQca
    on_failure: change
    on_success: change
    on_pull_requests: true
