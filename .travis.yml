language: java
cache:
  directories:
  - "~/.m2/repository"
jdk: openjdk11
env:
  global:
  # EG OSS Sonatype jira info
  - secure: NA1LDLSFPjfCJhv4aL4etZlvHKJ4vrqacu3aTVB81QFeMlTGnENRKXsmOhhUNkj6PAB0IfrStlud5EHuTM6LxOGcXov6aoj6grz1Cq9p7groaihFcRMizgp041wXAwl2FA7K8mLCpxP+NbgoaO6KhZYWso3JshKgzQ1THHDHNx423KkqNwyV8ddOzA0TynjGhEZPI40+ruuxgYS6dZk0ObwvdLdJUW2FLZeHKGxvKP7l4t4RseqmwAr47WK+pY7n6NjyWAaqPog/Wsd5XIiyo8AJA0WSdLtUjchE5gBKH7Bd5nw2zx/IqyQuSNZg73QYya1Pko0VW0YVq7fY9pN3D7cVkQVpmvLVAPFcMP32WWaMkzvEA4hFZRa2WShzdDCGA1uleD/v/YlFBKCmKyeIyeUYkd4/JsJOL9PLeFfx7ECpp3ZAFi8tGKiCTueFYLrIuLoOpOn5giB4/724Tkl54wRig5v3njaFFmeLhqW8Tox6KfFJ1qh3R8pEqwhFjOZFcWceURPkKNSOt19LFv7brT2dpFQuynX5I+CtcIqGBT4Jbqwmq7EyYhxx2508d6Gq9nNrOFvGukA1Q4JWyZLsCi+TuNHcxTLXN4AUPjeUmlRWT6hKBdjVxe/T5PLZPA6p9f6Gk+fO2wOS0+e5cwP8xS+osL/mLoG5U180YuKDTYU=
  - secure: Fb2ffyOik4TrfXuCPJIbTmkdfy7W3/3nRawgctOO8YeOpUSg356U3tPYWJZeWhq0XzHsIsloYUjdOcYV33E6sau+lHQ67OJEDHbyAHYOIh5l1HrDJVEwXs3S5W+pvDHrxamNi6BRzWDqp78hv56SMLD9vLlP0HOPAvfOosHwdA1Fg8OBaFRWYKSKuq45VdXRx9DTzNQacGiH97V0efzUfDFbuN9AsqTZl3LHcTocS3KLPyo3j2c4YW3/T6RSQJibBjMI1ZbZOrVbQYxZ+zPSKwUv5ucLVSJ2YrNQ+cKTYmOaIka2dBtK9lArbKtRYxvTtXz/fiL1CdD0mEhyP47TFErIWm5GIK5iVehzU9cRzB5s0t6P+D1eUi9uUh7+j5kndYbQb+ksdz1jxkMFw7lI8L0EQi78p+pfV830H199iLFJ8zbyTyce8sb4LNFuKu80DCPm79kpYq4o6bVVmvtLt5etOamKnhB6uq4Ho0ObGVNB+rnnQp03f67MGWV6LF75ati/1v3CGZ9ogjPMM2Tvxa8BttCV/0dKdqxoEJgHCXl91Pf/83B+CK5t4B4lXun1sIGHuqWUGBj3Xt8Ps4tgD/tJ52iXNzKRwyqG3gy6bvKlslu4WfyVKS7BIHQKMowLaoKyQ/h7OQ2NCsPWw+Cws6FVpYZejRyVv3XzOzFEPHg=
  # GPG_KEYNAME
  - secure: VGoLyHHb4exm8mw1OSS+zUWGqxcDOx9F2GF5q7TKr5uiqhMkBCz1Y4hTgBakYWfJLdhQl8F/UkUpjqVPN6NHz3q87aLeZtc5GB9D+kXhTuoMIZ34p0U5HEk63v06VvfmoMUfahEVZVeb3RWUAQGuliGokyiMRS3u4hK9UDTx91x4RRx/83pHn4o6NRAzIXyOoQIYwuLbCIleNVe35Ok2LKdk7NQ2i+nDVLdnjeuHWoF27R33CeiRRV+GvF7aJRksqKwPPS63nn6aGtEmlzemyYbiwDZ1wQbf9nuSZLaU78unTGq6qyVrYbpxegWHclPsM5EKxO34uqi3m0GLRuy/W+u0R9dRaCMk4aEPmz56ClDPrmjssMXn+pyumsKU4932aVA1Q/IP14H19P/3eH2FvJLnO00eGdKgqvVRbomOyRqlRWCI/mUsR0aAr+Go+32Orf88v79EAT0WmXBYgGiJR7d2Ig7YZxY5KnM+rto59J9tZbWQJRYr+jkw5W8dPTMVQ+a4T6kGcOR4e54KIqkW1BVa/I+aaiZSP0BrIGEbk2b1UmoYGOuxOBjs0ESDHaj6KFQK026WAoedQ/bYa8J+j7JRIg/ivlvH5eycXSFTXLt4Qym/iZ8SOnJr1mWTF4xCaOmyUBqSHS2tOPJiGuNdRpFep8QT9vBEXpej2yOLyDA=
  # GPG_PASSPHRASE
  - secure: bFylqtr43v1wetXH/b1RJDmsDzwn6ILfFnw0rVFVKdpYndoyL3J05A3qYdZ+K1cePP7cYnetfOlMnv/e1LDGSzQ/C2RmPgEZIPRozxg0t9S+QU/G+Ro5m1VhrEDOpJv2A7IxY7WBgWEhChIKTZlDK4c2rzXDJ/Z799QQRmiOu04zGVBUjPcbU01QlFF71e3Vf5sovBPSWPifmqyKHZPquqXbY5Jo36MDAO5b3aD/rk/6nkzB+b10fAEJ/9sXX14S0ItTc7CWkjGdqjMsu9lMYUZ8Au2YgBtGAU3XBG30+uhKk7Z2XZj8Ne9QJhPbzzt53bB0loa8pQ+k6NGcCPRoTZOI3tAKKPxXf1sRolE3gYmje1GcREvsXRnZbwfZuayCOBdEXFFZzmijz/H5UgNS5rUwrY+FH6Dl4AZsQvDJdC4nJ4IVo6knRM4yx4ooI47tJBLLQS5cFOTmpYnQdZZLr5s4EPRhFpqSa61a2ZoBzTDl4Jj3M/zZ9xtIajYEdYSZ/wGpErsA/KJbHnP32lukTVG86Ndh4E2xLVVo1U5iwTZA6EsvarHKvEqLGtOYMyC2TqxuTlgzsfuGkonAlj9jx8I51Hjc5NMuamqWl4uLY2nC2BpTY1Gaufb0AJkTfp0W1/yPxaS2SGYo18UDobOGQfDniEe4CiVUkpACj0Jq7kY=
install: skip
jobs:
  include:
    # If the branch is not master it just builds the application
    - stage: "Build"
      name: "Build and Test"
      install: travis_retry mvn clean install -DskipTests
    - stage: "Site Build and Quality check"
      name: "Publishing site and performing a code quality check"
      if: type NOT IN (pull_request) AND tag IS present
      before_deploy:
        - mvn versions:set -D newVersion=${TRAVIS_TAG}
        - travis_retry mvn install sonar:sonar -Dsonar.projectKey=${sonar_project_key} -Dsonar.organization=${sonar_organization} -Dsonar.host.url=${sonar_host_url} -Dsonar.login=${sonar_token} site:site javadoc:aggregate -P site-release
      deploy:
        provider: pages
        local-dir: target/site
        skip-cleanup: true
        github-token: ${github_oauth_token}
        keep-history: true
        on:
          tags: true
    - stage: "Release"
      name: "Releasing artifacts"
      if: type NOT IN (pull_request) AND tag IS present
      install: skip
      after_deploy: skip
      before_script:
        - openssl aes-256-cbc -K $encrypted_bbb0f94c13c1_key -iv $encrypted_bbb0f94c13c1_iv -in config/travis/private-key.gpg.enc -out config/travis/private-key.gpg -d
        - mvn versions:set -D newVersion=${TRAVIS_TAG}
        - mvn install -DskipTests -Dmaven.test.skip=true javadoc:aggregate
      deploy:
        - provider: script
          script: config/travis/deploy.sh
          skip_cleanup: true
          on:
            tags: true
notifications:
  slack:
    rooms:
      - bull-crew:hTuN6VsJod6aUOU6FWIFiQca
    on_failure: change
    on_success: change
    on_pull_requests: true
