language: java
jdk: oraclejdk11
os:
  - linux
cache:
  directories:
    - ~/.m2/repository
install:
  - 
jobs:
  include:
    # If the branch is not master it just builds the application
    - stage: "Build"
      name: "Build and Test"
      if: NOT branch = master
      install: travis_retry mvn clean install -Dmaven.javadoc.skip=true -B
    # If the branch is master it sends the quality report to SonarCloud
    - stage: "Build, Test and Quality Check"
      name: "Building, testing and sending a quality report to SonarCloud"
      if: branch = master
      install: travis_retry mvn clean install -B sonar:sonar -Dmaven.javadoc.skip=true -Dsonar.projectKey=${sonar_project_key} -Dsonar.organization=${sonar_organization} -Dsonar.host.url=${sonar_host_url} -Dsonar.login=${sonar_token}
    - stage: "Site Build and Publish"
      name: "Building site and publishing on GitHub pages"
      if: branch = master
      before_deploy: mvn install site:site -DskipTests=true -B
      deploy:
        provider: pages
        local-dir: target/site
        skip-cleanup: true
        github-token: ${github_oauth_token}
        keep-history: true
        on:
          branch: master
    - stage: "Release"
      name: "Releasing SNAPSHOT artifact on Maven central"
      if: NOT branch = master
      before_install: "cp config/travis/mvn-settings.xml $HOME/.m2/settings.xml"
      install: mvn deploy -B -DskipTests=true